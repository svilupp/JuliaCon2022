<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Methodology · MediaMixModellingDemo.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link rel="canonical" href="https://svilupp.github.io/MediaMixModellingDemo.jl/methodology/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">MediaMixModellingDemo.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Methodology</a><ul class="internal"><li><a class="tocitem" href="#Goals"><span>Goals</span></a></li><li><a class="tocitem" href="#Challenges"><span>Challenges</span></a></li><li><a class="tocitem" href="#Building-blocks"><span>Building blocks</span></a></li><li><a class="tocitem" href="#High-level-Workflow"><span>High-level Workflow</span></a></li><li><a class="tocitem" href="#Naming-Conventions-and-Variables"><span>Naming Conventions and Variables</span></a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../1-demo-high-level/">Demo - High-level API</a></li></ul></li><li><a class="tocitem" href="../practical_tips/">Practical Tips</a></li><li><a class="tocitem" href="../resources/">Resources</a></li><li><a class="tocitem" href="../api_reference/">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Methodology</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Methodology</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/svilupp/JuliaCon2022/MediaMixModellingDemo.jl/blob/main/MediaMixModellingDemo/docs/src/methodology.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Methodology"><a class="docs-heading-anchor" href="#Methodology">Methodology</a><a id="Methodology-1"></a><a class="docs-heading-anchor-permalink" href="#Methodology" title="Permalink"></a></h1><h2 id="Goals"><a class="docs-heading-anchor" href="#Goals">Goals</a><a id="Goals-1"></a><a class="docs-heading-anchor-permalink" href="#Goals" title="Permalink"></a></h2><ul><li>Quantify the benefits of your marketing activities (ROAS, mROAS, etc.)</li><li>Re-allocate marketing spend across different marketing channels/activities to maximize revenues</li></ul><h2 id="Challenges"><a class="docs-heading-anchor" href="#Challenges">Challenges</a><a id="Challenges-1"></a><a class="docs-heading-anchor-permalink" href="#Challenges" title="Permalink"></a></h2><ul><li>Insufficient data (eg, unobserved data, untracked data, too little data given the changing dynamics in the market)</li><li>Underspecified problem / weak identifiability (eg, Hill Curves for Ad spend saturation are &quot;too flexible&quot;)</li></ul><h2 id="Building-blocks"><a class="docs-heading-anchor" href="#Building-blocks">Building blocks</a><a id="Building-blocks-1"></a><a class="docs-heading-anchor-permalink" href="#Building-blocks" title="Permalink"></a></h2><h3 id="Modelling-decisions-to-make-it-work"><a class="docs-heading-anchor" href="#Modelling-decisions-to-make-it-work">Modelling decisions to make it work</a><a id="Modelling-decisions-to-make-it-work-1"></a><a class="docs-heading-anchor-permalink" href="#Modelling-decisions-to-make-it-work" title="Permalink"></a></h3><ul><li>Use Bayesian inference, which allows us to capture the uncertainty / underspecification of the key parameters</li><li>Specify our model with Turing / DynamicPPL, which allows us to apply almost any logic that we can express in Julia / we know from domain expertise</li><li>Leverage structural decomposition of the time series (eg, trend + seasonality + Ad spend + ...)</li><li>Fit the model in two stages to reduce the weak identifiability (effectively cutting the feedback of the first stage model on modelling the plain trend)</li><li>Reparametrize our model and scale all predictors, which enables us to easily leverage our domain knowledge (and existing experiments) and set informative priors</li><li>Operate on fitted results in MCMCChains, which allows to leverage many algorithms to fit our model, eg, HMC, NUTS, VI, MAP, ZigZag, etc</li><li>Apply Bayesian Decision Theory (custom loss function over the samples) to reflect your business’ context, preferences and decision making</li><li>Find the optimal budget with Metaheuristics to overcome that some objectives will be non-convex (ie, there will be local optima)</li></ul><h3 id="Discussion-of-Some-of-the-Implications"><a class="docs-heading-anchor" href="#Discussion-of-Some-of-the-Implications">Discussion of Some of the Implications</a><a id="Discussion-of-Some-of-the-Implications-1"></a><a class="docs-heading-anchor-permalink" href="#Discussion-of-Some-of-the-Implications" title="Permalink"></a></h3><ul><li>To make the pre-defined models re-usable, we must enforce certain naming and grouping conventions (eg, all marketing spend variables must be supplied in the same Dataframe, similarly all context variables must be supplied in another Dataframe) and standardization (context variables are standardized by Zscore, but revenues and marketing spend are Max() scaled to allow for easy conversions and setting of priors) - This is less relevant if you&#39;re using the high-level API</li><li>Max() scaling of revenues and marketing spend could be a poor choice if there are many outliers in the data (but that would also complicate matters for the auto priors for the Zscore transformed variables as they are loosely linked to standard deviation of the revenues</li><li>Reparametrization of the model allows directly setting the expected ROAS at an average ad spend level, but it implicitly assumes that the inflection of the Hill Curve (Halfmax concentration point or <code>halfmaxpoint</code> RV in the model) is at your average level as well (ie, if the channel is relatively underutilized / very low, it might be a too conservative assumption and it could reduce your fitted ROAS)</li><li>The models might be harder to fit (follow the standard Bayesian workflow and diagnostics - see FAQ for references)</li><li>Two-stage fit implicitly assumes independence between marketing spend and other variables (eg, holidays would not interact with marketing effects)</li><li>Second stage fit can be done on a smaller window if all inputs are masked (subset) consistently, but make sure to reflect this masking in plotting the fit results and in the optimization</li><li>Optimization can be run on a smaller window than the fit (<code>optim_mask</code>) but that reduces its potential uplift because there will be a ramp-up/adjustment period to adjust to new spend levels (because of the Geometric Decay) - make sure the optimization window is not too short to see the full effect of more “decayed” variables</li></ul><h2 id="High-level-Workflow"><a class="docs-heading-anchor" href="#High-level-Workflow">High-level Workflow</a><a id="High-level-Workflow-1"></a><a class="docs-heading-anchor-permalink" href="#High-level-Workflow" title="Permalink"></a></h2><ul><li>Transform data <ul><li>Response variable (=revenues) to be standardized to 0-1 range (where y=0 implies that revenue=0)</li><li>Variables that can have positive-only effects need to be standardized to 0-1 range (where =0 implies that value=0)</li><li>Variables with any-signed effects need to be at least standardized via Z-Score</li><li>Note: Code expects certain naming conventions (eg, X_spend for the DataFrame of the ad spend variables to be modelled - more on that below)</li></ul></li><li>Set priors / conversion factors<ul><li>Scale the priors based on the values of the input data</li><li>Leverage as much context + business knowledge as possible in setting possible parameters for the marketing transforms</li></ul></li><li>Stage 1: Fit the trend<ul><li>Extract separate series for growth trend, seasonality, holidays, organic variables </li><li>Create a new dataset (growth trend, seasonality, holidays) to use as a fixed input in the second stage </li></ul></li><li>Stage 2: Fit the coefficients for marketing transformation<ul><li>Validate the fit (Rhat, traceplots, etc)</li><li>Validate the model quality (Pseudo-R2, NRMSE) - we ideally need &gt;80% of the variation to be explained by our model to have meaningful results</li></ul></li><li>Quantify the contributions + ROAS of the current marketing spend<ul><li>Produce model fit summary 1-pager with key plots</li></ul></li><li>Optimize the marketing budget to maximize the marketing contribution <ul><li>Define a loss function that reflects your business&#39; decision-making process</li><li>Produce optimization summary 1-pager with the results of the optimization + inherent uncertainty</li></ul></li></ul><h2 id="Naming-Conventions-and-Variables"><a class="docs-heading-anchor" href="#Naming-Conventions-and-Variables">Naming Conventions and Variables</a><a id="Naming-Conventions-and-Variables-1"></a><a class="docs-heading-anchor-permalink" href="#Naming-Conventions-and-Variables" title="Permalink"></a></h2><p>Relevant only for the low-level API</p><h3 id="Input-data"><a class="docs-heading-anchor" href="#Input-data">Input data</a><a id="Input-data-1"></a><a class="docs-heading-anchor-permalink" href="#Input-data" title="Permalink"></a></h3><ul><li><p>Codebase depends on variables under the following names:</p><ul><li><p><code>X_spend</code>: DataFrame of Ad spend to be transformed (only positive coefficients will be allowed)</p></li><li><p><code>X_org</code>: DataFrame of organic variables (ie, only positive coefficients will be allowed)</p></li><li><p><code>X_cat</code>: 1-column DataFrame with a categorical variable (eg, for events)</p></li><li><p><code>X_hols</code>: DataFrame with holiday events (currently, 1-column with dummy encoding of holiday effect)</p></li><li><p><code>X_context</code>: Any context variables (eg, market drivers, market index, competitor popularity)</p></li><li><p><code>X_seas</code>: Created seasonality DataFrame</p></li><li><p><code>X_feat</code>: horizontal concatenation of X<em>spend,X</em>org,X_content (order does not matter)</p></li><li><p><code>X_trend</code>: Optional - Spline-basis for flexible trend modelling</p></li></ul><ul><li><p><code>y_std</code>: transformed response variable</p></li><li><p><code>y_true</code>: original response variable (=revenues)</p></li><li><p><code>time_std</code>: transformed time index running from 0-1 during the whole period (important for setting priors)</p></li><li><p><code>df</code>: series of datetime values corresponding to the observations</p></li><li><p><code>cols_spend</code>: Vector of ad spend variables in the same order as <code>X_spend</code> (ie, <code>names(X_spend)</code>)</p></li><li><p><code>cat_levels</code>: Integer of how many levels are in the 1-column DataFrame <code>X_cat</code></p></li></ul></li><li><p>Transformations caches saved under pipe<em>cache</em>y,pipe<em>cache</em>spend</p><ul><li><code>pipe_cache_y</code>: TableTransforms cache to revert y-variable transform</li><li><code>pipe_cache_spend</code>: TableTransforms cache to revert X_spend variables transform</li></ul></li><li><p>Functions:</p><ul><li><code>revert_pipe_y</code>: utility to revert transformation of y-variable</li><li><code>revert_pipe_spend</code>: utility to revert transformation of the ad spend variables</li></ul></li></ul><p>Reason: Most of them are used when setting conversion ratios and priors in <code>ParamsStage1</code> (variable called <code>p1</code>) and <code>ParamsStage2</code> (variable called <code>p2</code>)</p><h3 id="Turing-Models"><a class="docs-heading-anchor" href="#Turing-Models">Turing Models</a><a id="Turing-Models-1"></a><a class="docs-heading-anchor-permalink" href="#Turing-Models" title="Permalink"></a></h3><p>We will fit the model in 2 stages to deal with the under-specification.</p><p>As a convention the deterministic location of the observed variable (mean of the RV <code>y</code>) will be called <code>mu</code> and its components will be all prefixed as such, eg, </p><ul><li><code>mu_trend</code> for the trend component, </li><li><code>mu_seas</code> for the seasonality component, </li><li><code>mu_hols</code> for the holidays component,</li><li><code>mu_context</code> for the contributions of the contextual variables,</li><li><code>mu_org</code></li><li><code>mu_spend</code> for the contribution of all Ad spend variables together</li><li><code>mu_spend_by_var</code> for the contributions of each individual spend variable (ie, number of columns = number of Ad spend variables)</li></ul><p>(See <code>src/model_definition.jl</code> for more details)</p><p>All these deterministic components will be exposed by DynamicPPL in the return statement to be easily extracted via <code>generated_quantities()</code> conditioned on fitted samples (a <code>chains</code> object). In other words, given a model fit, we can easily extract all the above components by playing the samples through the model.</p><p>Fitted results from each stage:</p><ul><li>Stage 1: <ul><li>Fitted parameters (Chains): <code>chain_stage1</code></li><li>Generated quantities (eg, <code>mu_trend</code> etc): <code>stage1_fit</code></li></ul></li><li>Stage 2:<ul><li>Model used for fitting: <code>model_orig</code></li><li>Fitted parameters (Chains): <code>chain</code></li><li>Generated quantities (eg, <code>mu_trend</code> etc): <code>stage2_fit_allsamples</code> (or simply <code>stage2fit</code>) </li></ul></li></ul><h3 id="Optimization"><a class="docs-heading-anchor" href="#Optimization">Optimization</a><a id="Optimization-1"></a><a class="docs-heading-anchor-permalink" href="#Optimization" title="Permalink"></a></h3><p><code>budget_multiplier_optim</code> holds the recommended multiplier for the <code>X_spend</code> (=Ad spend) that yields the maximum revenue uplift. <code>simulations_optim</code> holds the generated quantities resulting from the above optimal Ad spend.</p><p>There is an option to run the optimization only on a subset of data using the mask <code>optim_mask</code>.</p><p>In general, most objects that are derived from this optimal budget are suffixed with <code>_optim</code> (eg, <code>simulations_optim</code>). In contrast, the un-optimized quantities are often suffixed as <code>_prev</code> (eg, <code>spend_share_prev</code>)</p><p>In addition, if there is a variable that has an original domain (=dollars) and a transformed domain like Ad spend, it will have additional suffix <code>_raw</code> and <code>_trf</code> for the original and transformed domain, respectively, (eg, optimal Ad spend standardized to 0-1 range -&gt; <code>X_spend_optim_trf</code> ). </p><p>To make the contrast really explicit, if some values are in the original domain, they could have the suffix <code>_raw</code></p><h3 id="Other"><a class="docs-heading-anchor" href="#Other">Other</a><a id="Other-1"></a><a class="docs-heading-anchor-permalink" href="#Other" title="Permalink"></a></h3><p>For plotting consistency, some of the defaults are saved in struct <code>ParamsPlot</code></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../1-demo-high-level/">Demo - High-level API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.22 on <span class="colophon-date" title="Friday 29 July 2022 13:09">Friday 29 July 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
